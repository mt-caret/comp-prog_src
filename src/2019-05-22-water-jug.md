---
title: "LeetCode 365: Water and Jug Problem"
date: 2019-05-22
---

<https://leetcode.com/problems/water-and-jug-problem/>

## 問題概要

容量$x, y$の容器$X, Y$に次の操作を用いて$z$を計れるかどうか求めよ。

1. 容器が一杯になるまで水を注ぐ
2. 容器の水を捨てて空にする
3. 片方の容器からもう片方への容器へ、一方が空になるか他方が一杯になるまで水を移す

## アプローチ

これらの操作を任意の回数行った時、それぞれの容器に入っている水量は必ず
$x, y$の倍数の和、つまり整数$a, b$が存在して$ax + by$の形になることを示す。

<details><summary>証明</summary>

> まず、両方の容器が空である初期状態では自明に条件を満たす。
>
> 次に、条件が満たされている状態でそれぞれの操作を考える。
>
> 操作1・2は注ぐ・空にする容器に元々入っていた水量に関わらず一杯・空にするため、
> 操作後も条件を満たす。
>
> 容器$X$から容器$Y$へ、操作3を行った場合を考える。移す元の容器の
> 水量と移す先の容器の水量を適当な整数$a, b, c, d$を用いて
> $ax + by \left(\le x \right), cx + dy \left(\le y \right)$とおと、次の2つの
> 場合が考えられる。
>
> #### [1] 移す先の容器が一杯になる
>
> 移す元の容器の水量は$ax + by - (y - (cx + dy)) = (a + c)x + (b + d - 1)y$
> となり、操作後も条件を満たす。移す先の容器の水量は自明に条件を満たす。
>
> #### [2] 移す元の容器が空になる
>
> 移す先の容器の水量は$cx + dy + (ax + by) = (a + c)x + (b + d)y$となり、
> 操作後も条件を満たす。移す元の容器の水量は自明に条件を満たす。

</details>

また、2つの容器に入っている水量がそれぞれ$x, y$の倍数の和である時、自明に
2つの容器に入っている水量の和も$x, y$の倍数の和になる。

次に$[0, x + y]$の範囲の任意の倍数の和$ax + by$の水量をこれらの操作を用いて
計ることができることを示す。

<details><summary>証明</summary>

> #### [1] $a, b$がどちらも$0$以上の時
>
> $ax + by \le x + y$より$a \le 1, b \le 1$であり、操作1を2つの容器について
> 適宜行うことによって計ることができる。
>
> #### [2] $a, b$のどちらかが負の時
>
> $a$を負だと仮定して一般性を失わない。$0 \le ax + by$より、$b \ge 1$となる。
> この時、$ax + by$という総量は、一杯になった容器$X$を計$-a$回捨て、
> 空な容器$Y$を計$b$回一杯にした量に変わりない。
>
> これは、次のように実現することができる。
>
> 1. まず、容器$Y$に操作1を行い一杯にし、操作3で水を容器$X$に移す。
> $y < x$の場合は容器$X$が一杯になるまでこれを繰り返す（この時
> $0 \le ax + by$より操作1を行う合計回数が$b$を越えることはない）。
>
> 2. 容器$X$に操作2を行い空にした後、容器$Y$に水が余っていた場合は
> 操作3を再度行い容器$Y$を空にする。
>
> 3. 1〜2を$a$回繰り返す。
>
> 4. 操作1を行った回数が$b$より少ない場合は足りない回数だけ容器$X$に操作3で水を
> 移しながら行う（この時$ax + by \le x + y$より操作1を必要回数行う前に容器$X$が
> 溢れてしまうことはない）。

</details>

これにより、$z$が$[0, x + y]$の範囲の$x, y$の倍数の和であることが$z$を
容器$X, Y$で計れることの必要十分条件であることが示された。

ここで、[ベズーの補題](https://ja.wikipedia.org/wiki/%E3%83%99%E3%82%BA%E3%83%BC%E3%81%AE%E7%AD%89%E5%BC%8F)
により任意の$x, y$の倍数の和は$x, y$の最大公約数の倍数になる。従って、$z$が
$[0, x + y]$の範囲の$x, y$の最大公約数の倍数であることが$z$を容器$X, Y$で
計れることの必要十分条件である。

コードに落とし込むと次のようになる。

```c++
bool canMeasureWater(int x, int y, int z) {
    return x + y >= z && z >= 0
        && ((x == 0 && y == z) || (y == 0 && x == z) || z % __gcd(x, y) == 0);
}
```
